<!DOCTYPE html>
<html>

<head>
<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?v=3&sensor=true"></script>
<meta charset=utf-8 />
<title>Transit Trip Planner</title>

<style id="jsbin-css">

@font-face {
    font-family: 'GothamBold';
    src: url('GothamBold.ttf') format('truetype');
}

body{
	font-family: 'Arial', sans-serif;
}

#outerContainer {
	/*border-width: 1px;
	border-color: black;
	border-style: solid;*/
	width: 903px;
	margin-left: auto;
	margin-right: auto;
}


#logoContainer {
  position: relative;
  height: 135px;
  width: 901px;
  /*border-width: 1px;
  border-color: black;
  border-style: solid;*/
  margin-left: auto;
  margin-right: auto;
  z-index: 1;
  margin-bottom: 30px;
  margin-top: 35px;
}

#backBtn {
	display: none;
	position: relative;
	width: 66px;
	height: 66px;
	/*border-width: 1px;
	border-color: black;
	border-style: solid;*/
	margin-left: -75px;
	background-image:url('back_btn-PNG.png');
	cursor: pointer;
	opacity: 1;
}

#backBtn:hover {
	opacity: 0.7;
}

#boxContainer {
  position: relative;
  height: 570px; /*380*/
  width: 903px; /*603*/
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 35px;
  z-index: 1;
}


#plan {
  background-color: #DB5902;
  height: 263px;
  width: 428px;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
  cursor: pointer;
}

#plan:hover {
  background-color: #E37C36 !important;
}

#planDiv {
  position: absolute;
  top: 6px;
  left: 6px;
  width: 890px;
  height: 527px;
  display: none;
  z-index: 20;
  background-color: #FFFFFF;
}

.label {
  position: absolute;
  bottom: 0;
  left: 0;
  margin-bottom: -6px;
  margin-left: 3px;
  font-family: 'GothamBold', 'Arial', sans-serif;
  color: #FFFFFF;
  font-size:280%;
  -webkit-user-select: none;      
  -moz-user-select: none;
  -ms-user-select: none;
}


#schedule {
  background-color: #477725;
  height: 263px;
  width: 428px;
  position: absolute;
  top: 0;
  right: 0;
  z-index: 1;
  cursor: pointer;
}

#schedule:hover {
  background-color: #6FA349 !important;
}

#scheduleDiv {
  position: absolute;
  top: 6px;
  left: 6px;
  width: 890px;
  height: 527px;
  display: none;
  font-family: 'GothamBold', 'Arial', sans-serif;
  color: #FFFFFF;
  z-index: 20;
  background-color: #304F19;
}

#skedInput {
  position: absolute;
  top: 15px;
  left: 15px;
  width: 220px;
  height: 527px;
}

#scheduleDisplay {
	position: absolute;
	top: 15px;
    left: 245px;
    width: 620px;
    height: 497px;
    background-color: #000000;
}

#info {
  background-color: #222B5E;
  height: 263px;
  width: 428px;
  position: absolute;
  bottom: 0;
  left: 0;
  z-index: 1;
  cursor: pointer;
}

#info:hover {
  background-color: #3B478A !important;
}


#glance {
  background-color: #4D5259;
  height: 263px;
  width: 428px;
  position: absolute;
  bottom: 0;
  right: 0;
  z-index: 0;
}

#footer {
	/*border-width: 1px;
	border-color: black;
	border-style: solid;*/
	font-size:x-large;
}

#mapCanvas {
	width: 700px;
	height: 500px;
	float:left;
}

#planBtnContainer {
	background-color:#DB5902;
}

#btnSave, #btnLoad, #btnClear {
	width:100px;
	height:25px;
}

#btnGo {
	width:40px;
	height:25px;
}

#busRoutes {
	background-color:#DB5902;
	height:500px;
	width:190px;
	float:left;
	text-align:center;
	font-family: 'GothamBold', 'Arial', sans-serif;
	color: #FFFFFF;
}

#route {
	margin-top:5px;
	margin-left:2px;
	height:150px;
	width:180px;
	border:2px solid;
	border-radius:3px;
	border-color:#000000;
	box-shadow: inset 0 0 0 3px rgba(255,255,255,.5);
	text-align:center;
	color:#FFFFFF;
}

#routeInfo {
	text-alight:left;
}

</style>
</head>


<body>

<div id="outerContainer"> 


<div id="logoContainer">
	<img src="transit_logo-3.png">
</div>


<div id="boxContainer"> 
  
	<div id="backBtn">
	</div>
	
	<div id="planDiv">
		<div id="planBtnContainer">
			<button id="btnSave" type="button">Save</button>
			<button id="btnLoad" type="button">Load</button>
			<button id="btnClear" onclick="clearMap()" type="button">Clear</button>
		</div>
		<div id="mapCanvas"></div>
		<div id="busRoutes">BUS ROUTES</div>
	</div>
  
	<div id="plan">
		<div class="label">
		PLAN A TRIP
		</div>
	</div>

	<div id="scheduleDiv">
		<div id="skedInput">
			<form>
				<br>
				Stop Number<br>
				<input type="text" placeholder="ex. 12345">
				<button id="btnGo" type="button">GO</button><br><br>
			</form>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR<br><br>
			<form>
				Route Number<br>
				<input type="text" placeholder="ex. 21">
				<button id="btnGo" type="button">GO</button><br><br>
			</form>
		</div>
		<div id="scheduleDisplay">
		</div>
	</div>
  
	<div id="schedule">
		<div class="label">
		SEE SCHEDULES
		</div>
	</div>
  
	<div id="info">
		<div class="label">
		MORE INFO
		</div>
	</div>
  
	<div id="glance">
	</div>
  
</div>


<div id="footer">
	<center>
		<a href="#">Privacy Policy</a> &nbsp|&nbsp <a href="#">Site Map</a> &nbsp|&nbsp <a href="#">Contact Us</a> &nbsp|&nbsp <a href="#">Help</a>
	</center>
</div>
 
 
</div> <!--end outerContainer-->
  

<script>
var globalVars = {};
var map;
var mapService = new google.maps.DirectionsService();
var points = new Array(); //holds all points on the map

$(document).ready(function(){

	globalVars.activeDiv = "";

	$('#plan').click(function() {
	  $(this).css('z-index',9);
	  $(this).css('background-color','#E37C36');
	  $(this).animate({width: ['903px', 'swing'], height: ['570px', 'swing']}, { duration: "slow", easing: "easein" });
	  
	  $('#backBtn').fadeIn(800, function() {
		initialize();
	  });
	  globalVars.activeDiv = "#plan";
	  displayDiv(globalVars.activeDiv,true);
	});
	

	$('#schedule').click(function() {
	  $(this).css('z-index',9);
	  $(this).css('background-color','#6FA349');
	  $(this).animate({width: ['903px', 'swing'], height: ['570px', 'swing']}, { duration: "slow", easing: "easein" });
	  
	  $('#backBtn').fadeIn(800);
	  globalVars.activeDiv = "#schedule";
	  displayDiv(globalVars.activeDiv,true);
	});

	
	$('#info').click(function() {
	  $(this).css('z-index',9);
	  $(this).css('background-color','#3B478A');
	  $(this).animate({width: ['903px', 'swing'], height: ['570px', 'swing']}, { duration: "slow", easing: "easein" });
	  
	  $('#backBtn').fadeIn(800);
	  globalVars.activeDiv = "#info";
	  displayDiv(globalVars.activeDiv,true);
	});
  
  
	$('#backBtn').click(function() {
		
		$(globalVars.activeDiv).animate(
			{width: ['428px', 'swing'], height: ['263px', 'swing']}, 
			{ duration: "slow", easing: "easein" });
		
		if ( globalVars.activeDiv == "#plan" ){
			$(globalVars.activeDiv).css('background-color','#DB5902');
			displayDiv(globalVars.activeDiv);
			clearMap();
		}else if ( globalVars.activeDiv == "#schedule" ){
			$(globalVars.activeDiv).css('background-color','#477725');
			displayDiv(globalVars.activeDiv);
		}else if ( globalVars.activeDiv == "#info" ){
			$(globalVars.activeDiv).css('background-color','#222B5E');
			displayDiv(globalVars.activeDiv);
		}

		$('#backBtn').fadeOut(600, function(){ $(globalVars.activeDiv).css('z-index',1); } );

	});

	
}); //document_ready


function displayDiv(var1,var2) {	
	if (var2 == true){
		$(var1 + 'Div').delay(450).fadeToggle();
	}else{
		$(var1 + 'Div').toggle();
	}
}

//loads the map
function initialize() {
    var map_canvas = document.getElementById('mapCanvas');
    var map_options = {
		center: new google.maps.LatLng(49.8994, -97.1392), //center map above winnipeg
        zoom: 14,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    map = new google.maps.Map(map_canvas, map_options)
	
	directionsRenderer = new google.maps.DirectionsRenderer();
	directionsRenderer.setMap(map);
	var renderer_options = {
		draggable: true
	}
	
	google.maps.event.addListener(map, "dblclick", function(event) {
		var origin = event.latLng;
		points.push(origin);
		findRoutes();
	});
}


function findRoutes() {
	var route = new Array();
	if (points.length == 2)
	{
		var i;
		for (i = 1; i < points.length-1; i++) {
			var address = points[i];
			if (address !== "") {
				route.push({
					location: address,
					stopover: true
				});
			}
		}
		draw(points[0], points[points.length - 1], route);
		populateBusRoutes(points[0], points[points.length-1]);
	} else if (points.length == 1) {
		draw(points[points.length - 1], points[points.length - 1], route); //draw first point
	}
	
}
//draws route on map
function draw(originPoint, destinationPoint, route) {
    var request = '';

    if (points.length > 1) {
        request = {
            origin: originPoint,
            destination: destinationPoint,
            waypoints: route,
            optimizeWaypoints: true,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };
    } else if (points.length == 1){
        request = {
            origin: originPoint,
            destination: destinationPoint,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };
    }
    mapService.route(request, function (response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            directionsRenderer.setDirections(response);
        }
    });
}

function populateBusRoutes(lon, lat) {

	//doesn't work... sadly
	/*$.getJSON('http://whateverorigin.org/get?url=' + encodeURIComponent('http://api.winnipegtransit.com/stops.json?lon=-97.138&api-key=fynPUFGaKVGpCwXZatEl&lat=49.895&distance=250') + '&callback=?', function(data){
		alert(data.contents);
	});*/
	
	var date = new Date().addMinutes(2);
	var stops = new Array();
	stops.push( {
		key: 63,
		name: "Eastbound Portage at Main",
		direction: "Eastbound",
		latitude: "49.89511",
		longitude: "-97.13715",
		time: "" + date.getHours() + ":" + date.getMinutes()
		} );
	date = new Date().addMinutes(8);
	stops.push( {
		key: 62,
		name: "Westbound Portage at Main",
		direction: "Westbound",
		latitude: "49.89532",
		longitude: "-97.13715",
		time: date.getHours() + ":" + date.getMinutes()
		} );
	date = new Date().addMinutes(10);
	stops.push( {
		key: 27,
		name: "Northbound Main at Pioneer",
		direction: "Northbound",
		latitude: "49.89436",
		longitude: "-97.1376",
		time: date.getHours() + ":" + date.getMinutes()
		} );
		
	//to add (?): clicking on a stop makes additional information show up?
	var list = document.getElementById('busRoutes');
	for (var i=0; i<stops.length;i++) {
		var newDiv = document.createElement('div');
		var newDivId = "route";
		newDiv.setAttribute('id',newDivId);
		newDiv.innerHTML = '<h1>Bus: #' + stops[i].key + '<h1>';
		
		var infoDiv = document.createElement('div');
		infoDiv.setAttribute('id',"routeInfo");		
		infoDiv.innerHTML = 'Time: ' + stops[i].time + '<br/>Direction: ' + stops[i].direction + '<br/>';
		
		newDiv.appendChild(infoDiv);
		list.appendChild(newDiv);		
	}
	

}

Date.prototype.addMinutes= function(h){
    this.setMinutes(this.getMinutes()+h);
    return this;
}

function clearMap() {
	initialize();
	points = new Array();
	document.getElementById("busRoutes").innerHTML = "BUS ROUTES";
}

</script>
</body>
</html>
  